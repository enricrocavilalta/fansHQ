<!--<link rel="stylesheet" href="/styles.css">-->
<link rel="stylesheet" href="/styles_typed_colors.css">
<%- include('../partials/header') %>
<%- include('../partials/create_post') %>
<style>
  body {
  background-color: #000;
  color: #fff;
  font-family: sans-serif;
}

.post-grid-container {
  margin: 0 auto;
  width: 100%;
  max-width: 100%;
}

.post-grid-container h2 {
  margin-bottom: 1rem;
}

.post-grid {
  display: grid;
  grid-template-columns: repeat(var(--columns, 1), minmax(0, 1fr)); /* 1 column default */
  gap: 1rem;
}

.post-card {
  /*background-color: #1e1e1e;*/
  border-radius: 12px;
  padding: 1rem;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  transition: background-color 0.2s ease;
  overflow: visible; /* or remove if not needed */
  min-width: 0;
  word-break: break-word;
  overflow-wrap: break-word;
}

.post-card:hover {
 /* background-color: #2a2a2a;*/
}

.post-card h3 {
  margin: 0 0 0.5rem;
  font-size: 1.1rem;
}

.post-card p {
  font-size: 0.9rem;
  margin-bottom: 0.5rem;
}

.author-info {
  font-size: 0.8rem;
  color: #888;
}

.author-info a {
  color: hsl(180, 90%, 50%);
  text-decoration: underline;
}

.author-info a:visited {
  color: hsl(300, 90%, 50%);
  text-decoration: underline;
}

.author-info a:hover {
  color: hsl(60, 90%, 50%);
  text-decoration: underline;
}

.post-card img {
  width: 100%;
  height: auto;
  display: block;
  border-radius: 8px;
}

.post-card video {
  width: 100%;
  height: auto;
  display: block;
  border-radius: 8px;
}

.post-card audio {
  width: 100%;
  display: block;
  margin-top: 0.5rem;
}

.latest-posts-header {
  display: flex;
  justify-content: center;  /* centers horizontally */
  align-items: center;      /* centers vertically */
}

.latest-posts-title {
  display: inline-flex;
  align-items: center; /* keeps text & dropdown aligned */
  gap: 8px;
  margin: 0;
}

.latest-posts-title select {
  background-color: #1e1e1e; /* dark background */
  color: #fff;              /* white text */
  border: 1px solid #444;   /* subtle border */
  border-radius: 4px;
  padding: 4px 6px;
}

.latest-posts-title select:focus {
  outline: none;
  border-color: #888; /* lighter on focus */
}

.post-grid {
  background-color: #101010;  /* slightly lighter than background */
  padding: 16px;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.3);
  margin-top: 16px;
}

.file-link:link {
  color: hsl(180, 90%, 50%);
}

.file-link:visited {
  color: hsl(300, 90%, 50%);
}

.file-link:hover {
  color: hsl(60, 90%, 50%);
}


</style>

<head>
  <%- include('../partials/title', { pageTitle: 'Home · fansHQ' }) %>
  <link rel="icon" type="image/png" href="/HQgold.png">
</head>

<!-- Posts Grid -->
<section class="post-grid-container">

<div class="post-grid">

<div class="latest-posts-header">
  <h2 class="latest-posts-title">
    Latest Posts
    <select id="columnSelector">
      <option value="1">1 Column</option>
      <option value="2">2 Columns</option>
      <option value="3">3 Columns</option>
      <option value="4">4 Columns</option>
    </select>
  </h2>
</div>

<% posts.forEach(post => { %>
  

    <% if (post.media_type === 'text') { %>
      <div class="post-card" data-media="<%= post.media_type %>">
        <% if (post.title) { %><h3><%= post.title %></h3><% } %>
        <% if (post.content) { %><p><%= post.content %></p><% } %>
      </div>

    <% } else if (post.media_type === 'image') { %>
      <div class="post-card" data-media="<%= post.media_type %>">
        <% if (post.media_url) { %>
          <img src="<%= post.media_url %>" alt="" class="w-full rounded mt-2" />
        <% } %>
        <% if (post.title) { %><h3><%= post.title %></h3><% } %>
        <% if (post.content) { %><p><%= post.content %></p><% } %>
      </div>

    <% } else if (post.media_type === 'video') { %>
      <div class="post-card" data-media="<%= post.media_type %>">
        <% if (post.media_url) { %>
          <video controls class="w-full rounded mt-2">
            <source src="<%= post.media_url %>">
          </video>
        <% } %>
        <% if (post.title) { %><h3><%= post.title %></h3><% } %>
        <% if (post.content) { %><p><%= post.content %></p><% } %>
      </div>

    <% } else if (post.media_type === 'audio') { %>
      <div class="post-card" data-media="<%= post.media_type %>">
        <% if (post.media_url) { %>
          <audio controls class="w-full mt-2">
            <source src="<%= post.media_url %>">
          </audio>
        <% } %>
        <% if (post.title) { %><h3><%= post.title %></h3><% } %>
        <% if (post.content) { %><p><%= post.content %></p><% } %>
      </div>

    <% } else if (post.media_type === 'file') { %>
      <a href="<%= post.media_url %>" download="<%= post.title || 'download' %>" class="file-link" class="mt-2 inline-block">
        <div class="post-card" data-media="<%= post.media_type %>">
          <% if (post.media_url) { %>
            <h3><%= post.title || 'download' %></h3>
            <% if (post.content) { %><p><%= post.content %></p><% } %>
          <% } %>
        </div>
      </a>
    <% } else if (post.media_type === 'link') { %>
      <% if (post.media_url) { %>
        <a href="<%= post.media_url %>" target="_blank" rel="noopener" class="file-link" class="underline mt-2 inline-block">
          <div class="post-card" data-media="<%= post.media_type %>">
            <h3><%= post.title || 'link' %></h3>
            <% if (post.content) { %><p><%= post.content %></p><% } %>
          </div>
        </a>
      <% } %>
    <% } else if (post.media_type === 'embed') { %>
      <div class="post-card" data-media="<%= post.media_type %>">
        <% if (post.media_url) { %>
          <div class="video-wrapper mt-2">
            <iframe src="<%= post.media_url %>" class="w-full rounded" frameborder="0" allowfullscreen></iframe>
          </div>
        <% } %>
        <% if (post.title) { %><h3><%= post.title %></h3><% } %>
        <% if (post.content) { %><p><%= post.content %></p><% } %>
      </div>
    <% } else if (post.media_type === 'poll') { %>
      <div class="post-card" data-media="<%= post.media_type %>">
        <% if (post.title) { %><h3><%= post.title %></h3><% } %>
        <% if (post.content) { %><p><%= post.content %></p><% } %>
        <% if (post.option_1) { %><p><%= post.votes_1 + " " + post.option_1 %></p><% } %>
        <% if (post.option_2) { %><p><%= post.votes_2 + " " + post.option_2 %></p><% } %>
        <% if (post.option_3) { %><p><%= post.votes_3 + " " + post.option_3 %></p><% } %>
        <% if (post.option_4) { %><p><%= post.votes_4 + " " + post.option_4 %></p><% } %>
        <% if (post.option_5) { %><p><%= post.votes_5 + " " + post.option_5 %></p><% } %>
        <% if (post.option_6) { %><p><%= post.votes_6 + " " + post.option_6 %></p><% } %>
        <% if (post.option_7) { %><p><%= post.votes_7 + " " + post.option_7 %></p><% } %>
        <% if (post.option_8) { %><p><%= post.votes_8 + " " + post.option_8 %></p><% } %>
        <% if (post.option_9) { %><p><%= post.votes_9 + " " + post.option_9 %></p><% } %>
        <% if (post.option_10) { %><p><%= post.votes_10 + " " + post.option_10 %></p><% } %>
      </div>

    <% } else if (post.media_type === 'product') { %>
      <div class="post-card" data-media="<%= post.media_type %>">

        <% // price can be "1.00" (string) or null; cast safely %>
        <% const p = (post.price == null) ? null : Number(parseFloat(String(post.price))); %>
        <% if (p !== null && Number.isFinite(p) && p != 0) { %>
        <h2>€<%= p.toFixed(2) %></h2>
        <% } %>

        <% if (post.media_url) { %>
          <img 
            src="<%= post.media_url %>" 
            alt="<%= post.title || 'Product image' %>" 
            class="max-w-full h-auto rounded-lg"
          />
        <% } %>

        <% if (post.title) { %><h3><%= post.title %></h3><% } %>
        
        <% if (post.content) { %><p><%= post.content %></p><% } %>
      
      </div>

    <% } else if (post.media_type === 'tipjar') { %>
      <div class="post-card" data-media="<%= post.media_type %>">
        

        <% if (post.media_url) { %>
          <img 
            src="<%= post.media_url %>" 
            alt="<%= post.title || 'Product image' %>" 
            class="max-w-full h-auto rounded-lg"
          />
        <% } %>

        <% if (post.title) { %><h3><%= post.title %></h3><% } %>
        
        <% if (post.content) { %><p><%= post.content %></p><% } %>

        <form action="/tip/<%= post.id %>">
          <button type="submit" method="POST" style="background-color: #303030;color:#f0f0f0; border: none; border-radius: 6px;">DONATE</button>
          <input type="number" name="tip" id="tip" value="<%= post.price %>" step="1" min="1" size="3" style="text-align:right; background-color: #303030;color:#f0f0f0; border: none; border-radius: 6px;"; required>$
        </form>

      </div>

    <% } else if (post.media_type === 'ama') { %>
      <div class="post-card" data-media="<%= post.media_type %>">

        <% if (post.title) { %><h3><%= post.title %></h3><% } %>
        
        <% if (post.content) { %><p><%= post.content %></p><% } %>

        <form action="/tip/<%= post.id %>">
          <textarea type="text" name="question" id="question" value="?" style="background-color: #303030;color:#f0f0f0; border: none; border-radius: 6px;"; size="100" data-autogrow required></textarea>
          <br>
          <button type="submit" method="POST" style="background-color: #303030;color:#f0f0f0; border: none; border-radius: 6px;">ASK</button>
           </form>
      </div>
      
    <% } else { %>
      <div class="post-card" data-media="<%= post.media_type %>">
        <!-- Fallback for unknown type -->
        <% if (post.title) { %><h3><%= post.title %></h3><% } %>
        <% if (post.content) { %><p><%= post.content %></p><% } %>
        <% if (post.media_url) { %>
          <a href="<%= post.media_url %>" target="_blank" rel="noopener" class="underline mt-2 inline-block">
            Open link
          </a>
        <% } %>
      </div>
    <% } %>

    <!-- Optional: simple author/date (kept outside to avoid repetition of the same block 10x) -->
    <div class="author-info mt-3 text-sm opacity-80">
      By
      <% if (post.email) { %>
        <a href="/posts/by/<%= post.user_id %>"><%= post.email.split('@')[0] %></a>
      <% } else { %>unknown<% } %>
      · <%= new Date(post.created_at).toLocaleDateString() %>
    </div>
<% }); %>


</section>

<script>
  const selector = document.getElementById('columnSelector');
  const grid = document.querySelector('.post-grid');

  selector.addEventListener('change', (e) => {
    grid.style.setProperty('--columns', e.target.value);
  });
</script>

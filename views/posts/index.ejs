<h1>Create a post</h1>
<ul>
  <li><a href="/posts/new/text">📝 Text</a></li>
  <li><a href="/posts/new/image">🖼️ Image</a></li>
  <li><a href="/posts/new/video">🎥 Video</a></li>
  <li><a href="/posts/new/audio">🎧 Audio</a></li>
  <li><a href="/posts/new/link">🔗 Link</a></li>
  <li><a href="/posts/new/download">📎 Download</a></li>
  <li><a href="/posts/new/poll">📊 Poll</a></li>
  <li><a href="/posts/new/product">🛒 Product</a></li>
</ul>

<h1>All posts</h1>
<ul>
<% posts.forEach(post => { %>
  <div class="post-card">
    <% if (post.media_type === 'text') { %>
      <h3><%= post.title %></h3>
      <p><%= post.content %></p>

    <% } else if (post.media_type === 'image') { %>
      <img src="<%= post.media_url %>" alt="Imagen subida" class="thumbnail">
      <% if (post.title) { %><h3><%= post.title %></h3><% } %>
      <% if (post.content) { %><p><%= post.content %></p><% } %>

    <% } else if (post.media_type === 'video') { %>
      <video controls src="<%= post.media_url %>" 
        <% if (post.thumbnail_url) { %> poster="<%= post.thumbnail_url %>" <% } %>
        class="video-player">
      </video>
      <% if (post.title) { %><h3><%= post.title %></h3><% } %>

    <% } else if (post.media_type === 'audio') { %>
      <audio controls src="<%= post.media_url %>"></audio>
      <% if (post.title) { %><h3><%= post.title %></h3><% } %>

    <% } else if (post.media_type === 'link') { %>
      <% if (post.display_mode === 'image' && post.thumbnail_url) { %>
        <a href="<%= post.media_url %>" target="_blank">
          <img src="<%= post.thumbnail_url %>" alt="Thumbnail" class="thumbnail">
        </a>
      <% } else if (post.display_mode === 'text' && post.display_text) { %>
        <a href="<%= post.media_url %>" target="_blank"><%= post.display_text %></a>
      <% } else { %>
        <a href="<%= post.media_url %>" target="_blank"><%= post.media_url %></a>
      <% } %>

    <% } else if (post.media_type === 'download') { %>
      <a href="<%= post.media_url %>" download><%= post.title || "Descargar archivo" %></a>
      <% if (post.content) { %><p><%= post.content %></p><% } %>

    <% } else if (post.media_type === 'poll') { %>
      <h3><%= post.title %></h3>
      <p><%= post.content %></p> <!-- This is the question -->
      <ul>
        <% for (var i = 1; i <= 10; i++) {
          var option = post['option_' + i];
          var votes = post['votes_' + i];
          if (option) { %>
            <li><%= option %> (<%= votes || 0 %> votes)</li>
        <%  } } %>
      </ul>

    <% } else if (post.media_type === 'product') { %>
      <h3><%= post.title || "Producto" %></h3>
      <% if (post.media_url) { %>
        <img src="<%= post.media_url %>" alt="Producto" class="thumbnail">
      <% } %>
      <% if (post.content) { %><p><%= post.content %></p><% } %>
      <% if (post.price) { %><p><strong>Precio:</strong> €<%= post.price %></p><% } %>

    <% } else { %>
      <p><%= post.content %></p> <!-- For fallback -->
    <% } %>

    <!-- Botones de editar y eliminar -->
    <div class="post-actions">
      <form action="/posts/<%= post.id %>/edit" method="get" style="display:inline;">
        <button type="submit">✏️ Editar</button>
      </form>
      <form action="/posts/<%= post.id %>/delete" method="post" style="display:inline;" onsubmit="return confirm('¿Eliminar este post?');">
        <button type="submit">🗑️ Eliminar</button>
      </form>
    </div>
  </div>
<% }); %>
</ul>

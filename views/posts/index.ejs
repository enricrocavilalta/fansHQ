<!--<link rel="stylesheet" href="/styles.css">-->
<link rel="stylesheet" href="/styles_typed_colors.css">
<%- include('../partials/header') %>
<%- include('../partials/create_post') %>
<style>
  body {
  background-color: #000;
  color: #fff;
  font-family: sans-serif;
}

.post-grid-container {
  margin: 0 auto;
  width: 100%;
  max-width: 100%;
}

.post-grid-container h2 {
  margin-bottom: 1rem;
}

.post-grid {
  display: grid;
  grid-template-columns: repeat(var(--columns, 1), minmax(0, 1fr)); /* 1 column default */
  gap: 1rem;
}

.post-card {
  /*background-color: #1e1e1e;*/
  border-radius: 12px;
  padding: 1rem;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  transition: background-color 0.2s ease;
  overflow: visible; /* or remove if not needed */
  min-width: 0;
  word-break: break-word;
  overflow-wrap: break-word;
}

.post-card:hover {
 /* background-color: #2a2a2a;*/
}

.post-card h3 {
  margin: 0 0 0.5rem;
  font-size: 1.1rem;
  color: #fff;
}

.post-card p {
  font-size: 0.9rem;
  color: #ccc;
  margin-bottom: 0.5rem;
}

.author-info {
  font-size: 0.8rem;
  color: #888;
}

.author-info a {
  color: #3fa9f5;
  text-decoration: none;
}

.author-info a:hover {
  text-decoration: underline;
}

.post-card img {
  width: 100%;
  height: auto;
  display: block;
  border-radius: 8px;
}

.post-card video {
  width: 100%;
  height: auto;
  display: block;
  border-radius: 8px;
}

.post-card audio {
  width: 100%;
  display: block;
  margin-top: 0.5rem;
}

</style>

<!-- Posts Grid -->
<section class="post-grid-container">
  <h2 style="text-align:center;color:#f0f0f0;">Latest posts</h2>

  <div class="post-grid">
<% posts.forEach(post => { %>
  <div class="post-card" data-media="<%= post.media_type %>">

    <% if (post.media_type === 'text') { %>
      <% if (post.title) { %><h3><%= post.title %></h3><% } %>
      <% if (post.content) { %><p><%= post.content %></p><% } %>

    <% } else if (post.media_type === 'image') { %>
      <% if (post.media_url) { %>
        <img src="<%= post.media_url %>" alt="" class="w-full rounded mt-2" />
      <% } %>
      <% if (post.title) { %><h3><%= post.title %></h3><% } %>
      <% if (post.content) { %><p><%= post.content %></p><% } %>

    <% } else if (post.media_type === 'video') { %>
      <% if (post.media_url) { %>
        <video controls class="w-full rounded mt-2">
          <source src="<%= post.media_url %>">
        </video>
      <% } %>
      <% if (post.title) { %><h3><%= post.title %></h3><% } %>
      <% if (post.content) { %><p><%= post.content %></p><% } %>

    <% } else if (post.media_type === 'audio') { %>
      <% if (post.media_url) { %>
        <audio controls class="w-full mt-2">
          <source src="<%= post.media_url %>">
        </audio>
      <% } %>
      <% if (post.title) { %><h3><%= post.title %></h3><% } %>
      <% if (post.content) { %><p><%= post.content %></p><% } %>

    <% } else if (post.media_type === 'pdf') { %>
      <% if (post.media_url) { %>
        <object data="<%= post.media_url %>" type="application/pdf" class="w-full mt-2 rounded" style="height:70vh;">
          <p>PDF preview unavailable. <a href="<%= post.media_url %>" download>Download PDF</a></p>
        </object>
        <div class="mt-2"><a href="<%= post.media_url %>" download class="underline">Download PDF</a></div>
      <% } %>
      <% if (post.title) { %><h3><%= post.title %></h3><% } %>
      <% if (post.content) { %><p><%= post.content %></p><% } %>

    <% } else if (post.media_type === 'download') { %>
      <% if (post.media_url) { %>
        <a href="<%= post.media_url %>" download="<%= post.title || 'download' %>" class="underline mt-2 inline-block">
          â¬‡ Download <%= post.title || 'file' %>
        </a>
      <% } %>
      <% if (post.title) { %><h3><%= post.title %></h3><% } %>
      <% if (post.content) { %><p><%= post.content %></p><% } %>

    <% } else if (post.media_type === 'link') { %>
      <% if (post.media_url) { %>
        <a href="<%= post.media_url %>" target="_blank" rel="noopener" class="underline mt-2 inline-block">
          ðŸ”— <%= post.title || 'View link' %>
        </a>
      <% } %>
      <% if (!post.media_url && post.title) { %><h3><%= post.title %></h3><% } %>
      <% if (post.content) { %><p><%= post.content %></p><% } %>

    <% } else if (post.media_type === 'embed') { %>
      <% if (post.media_url) { %>
        <div class="video-wrapper mt-2">
          <iframe src="<%= post.media_url %>" class="w-full rounded" frameborder="0" allowfullscreen></iframe>
        </div>
      <% } %>
      <% if (post.title) { %><h3><%= post.title %></h3><% } %>
      <% if (post.content) { %><p><%= post.content %></p><% } %>

    <% } else if (post.media_type === 'poll') { %>
      <% if (post.title) { %><h3><%= post.title %></h3><% } %>
      <% if (post.content) { %><p><%= post.content %></p><% } %>
      <!-- Render simple poll placeholder; replace with real options -->
      <div class="mt-2">[Poll options here]</div>

    <% } else if (post.media_type === 'product') { %>
      <% if (post.title) { %><h3><%= post.title %></h3><% } %>
      <% if (post.content) { %><p><%= post.content %></p><% } %>
      <% if (post.media_url) { %>
        <a href="<%= post.media_url %>" target="_blank" rel="noopener" class="underline mt-2 inline-block">
          View product
        </a>
      <% } %>

    <% } else { %>
      <!-- Fallback for unknown type -->
      <% if (post.title) { %><h3><%= post.title %></h3><% } %>
      <% if (post.content) { %><p><%= post.content %></p><% } %>
      <% if (post.media_url) { %>
        <a href="<%= post.media_url %>" target="_blank" rel="noopener" class="underline mt-2 inline-block">
          Open link
        </a>
      <% } %>
    <% } %>

    <!-- Optional: simple author/date (kept outside to avoid repetition of the same block 10x) -->
    <div class="author-info mt-3 text-sm opacity-80">
      By
      <% if (post.email) { %>
        <a href="/posts/by/<%= post.user_id %>"><%= post.email.split('@')[0] %></a>
      <% } else { %>unknown<% } %>
      Â· <%= new Date(post.created_at).toLocaleDateString() %>
    </div>
  </div>
<% }); %>


</section>

<script>
  const selector = document.getElementById('columnSelector');
  const grid = document.querySelector('.post-grid');

  selector.addEventListener('change', (e) => {
    grid.style.setProperty('--columns', e.target.value);
  });
</script>

<link rel="stylesheet" href="/styles.css">
<%- include('../partials/header') %>
<%- include('../partials/create_post') %>
<style>
  body {
  background-color: #000;
  color: #fff;
  font-family: sans-serif;
}

.post-grid-container {
  margin: 0 auto;
  width: 100%;
  max-width: 100%;
  padding: 1rem;
}

.post-grid-container h2 {
  margin-bottom: 1rem;
}

.post-grid {
  display: grid;
  grid-template-columns: repeat(var(--columns, 1), minmax(0, 1fr)); /* 1 column default */
  gap: 1rem;
}

.post-card {
  background-color: #1e1e1e;
  border-radius: 12px;
  padding: 1rem;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  transition: background-color 0.2s ease;
  overflow: visible; /* or remove if not needed */
  min-width: 0;
  word-break: break-word;
  overflow-wrap: break-word;
}

.post-card:hover {
  background-color: #2a2a2a;
}

.post-card h3 {
  margin: 0 0 0.5rem;
  font-size: 1.1rem;
  color: #fff;
}

.post-card p {
  font-size: 0.9rem;
  color: #ccc;
  margin-bottom: 0.5rem;
}

.author-info {
  font-size: 0.8rem;
  color: #888;
}

.author-info a {
  color: #3fa9f5;
  text-decoration: none;
}

.author-info a:hover {
  text-decoration: underline;
}

.post-card[data-media="text"] {
  border-top: 4px solid hsl(240, 90%, 50%);
  background-color: hsl(240, 50%, 10%);
}
.post-card[data-media="image"] {
  border-top: 4px solid hsl(60, 90%, 50%);
  background-color: hsl(60, 50%, 10%);
}
.post-card[data-media="video"] {
  border-top: 4px solid hsl(0, 90%, 50%);
  background-color: hsl(0, 50%, 10%);
}
.post-card[data-media="audio"] {
  border-top: 4px solid hsl(120, 90%, 50%);
  background-color: hsl(120, 50%, 10%);
}
.post-card[data-media="link"] {
  border-top: 4px solid hsl(180, 90%, 50%);
  background-color: hsl(180, 50%, 10%);
}
.post-card[data-media="download"] {
  border-top: 4px solid hsl(300, 90%, 50%);
  background-color: hsl(300, 50%, 10%);
}
.post-card[data-media="poll"] {
  border-top: 4px solid hsl(270, 90%, 50%);
  background-color: hsl(270, 50%, 10%);
}
.post-card[data-media="product"] {
  border-top: 4px solid hsl(30, 90%, 50%);
  background-color: hsl(30, 50%, 10%);
}
.post-card[data-media="ama"] {
  border-top: 4px solid hsl(0, 0%, 90%);
  background-color: hsl(0, 0%, 10%);
}
.post-card[data-media="tipjar"] {
  border-top: 4px solid hsl(0, 0%, 50%);
  background-color: hsl(0, 0%, 5%);
}
</style>

<!-- Posts Grid -->
<section class="post-grid-container">
  <h2 style="text-align:center;color:#f0f0f0;">Latest posts</h2>

  <div class="post-grid">
    <% posts.forEach(post => { %>
      
      <div class="post-card" data-media="<%= post.media_type %>">

        <% if (post.media_url) { %>
          <% if (post.media_type === 'image') { %>
            <img src="<%= post.media_url %>" alt="Image" class="w-full rounded mt-2" />
          <% } else if (post.media_type === 'video') { %>
            <video controls class="w-full rounded mt-2">
              <source src="<%= post.media_url %>" type="video/mp4">
            </video>
          <% } else if (post.media_type === 'audio') { %>
            <audio controls class="w-full mt-2">
              <source src="<%= post.media_url %>" type="audio/mpeg">
            </audio>
          <% } %>
        <% } %>

        <% if (post.title) { %>
          <h3><%= post.title %></h3>
        <% } %>

        <% if (post.content) { %>
          <p><%= post.content.slice(0, 100) %>...</p>
        <% } %>

        <div class="author-info">
          By <a href="/by/<%= post.user_id %>">
            <%= post.email ? post.email.split('@')[0] : 'unknown' %>
          </a>
          Â· <%= new Date(post.created_at).toLocaleDateString() %>
        </div>
      </div>
    <% }); %>
  </div>
</section>

<script>
  const selector = document.getElementById('columnSelector');
  const grid = document.querySelector('.post-grid');

  selector.addEventListener('change', (e) => {
    grid.style.setProperty('--columns', e.target.value);
  });
</script>
